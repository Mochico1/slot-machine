<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Slot Machine</title>
  <!-- React / ReactDOM -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <!-- GSAP -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <style>
    body {
      background: radial-gradient(circle, #222, black);
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0; 
      padding: 0;
    }
    .slot-machine {
      background: linear-gradient(135deg, #ffcc00, #ff6600);
      margin: 50px auto;
      width: 300px; 
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
      border: 5px solid gold;
      position: relative;
    }
    .reels {
      display: flex;
      justify-content: center;
      font-size: 40px;
      margin-bottom: 20px;
      background: black;
      border-radius: 10px;
      overflow: hidden;
      width: 240px;
      height: 80px;   /* On ne voit qu'un «hublot» de 80px */
      border: 3px solid gold;
      margin: 0 auto 20px auto;
    }
    .reel {
      width: 60px;   /* Un rouleau fait 60px de large */
      height: 80px;  /* et 80px de haut, identique au conteneur. */
      position: relative;
      overflow: hidden;
      margin: 0 2px;
    }
    .symbol-container {
      position: absolute;
      width: 100%;
      /* On va empiler 11 symboles en colonne => 11 * 60px de hauteur = 660px */
    }
    .symbol {
      width: 100%;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      background: #333;
      border-radius: 5px;
      margin-top: 0;
    }
    .spin-btn {
      padding: 15px 30px;
      background: gold;
      color: black;
      font-size: 20px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s ease-in-out, box-shadow 0.3s;
      box-shadow: 0 4px 10px rgba(255, 215, 0, 0.7);
    }
    .spin-btn:hover {
      transform: scale(1.05);
    }
    .spin-btn:active {
      transform: scale(0.95);
    }
    .spin-btn:disabled {
      background: gray;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    function SlotMachine() {
      const symbols = ['🍒','🍋','🍊','🍉','⭐','🔔','💎'];
      const [reels, setReels] = React.useState([
        ['🍒','🍋','🍊'], 
        ['🍉','⭐','🔔'], 
        ['💎','🍒','🍋']
      ]);
      const [spinning, setSpinning] = React.useState(false);
      const [spinCount, setSpinCount] = React.useState(0);

      function spin() {
        if (spinning) return;
        setSpinning(true);
        // Incrémente le nombre de spins
        setSpinCount(prev => prev + 1);

        // 50% de chance de gagner
        const isWin = (spinCount % 2 === 1);

        // On va créer 11 symboles par rouleau : 10 en défilement + 1 final
        // => L'animation partira du symbole 0 à 9, et le 10e sera celui qui s'arrête
        let newReels = [[], [], []];

        for (let i = 0; i < 3; i++) {
          // 10 symboles aléatoires pour le «défilement»
          for (let j = 0; j < 10; j++) {
            newReels[i].push(symbols[Math.floor(Math.random() * symbols.length)]);
          }
        }

        // Détermine le dernier symbole (final) pour chaque rouleau
        if (isWin) {
          // Gagnant => Même symbole sur les 3 rouleaux
          const winningSymbol = symbols[Math.floor(Math.random() * symbols.length)];
          newReels = newReels.map(() => [...newReels[0], winningSymbol]);
          // On remplit chaque rouleau à 11 items (les 10 random + 1 final identique)
        } else {
          // Perdu => symboles aléatoires
          for (let i = 0; i < 3; i++) {
            newReels[i].push(symbols[Math.floor(Math.random() * symbols.length)]);
          }
        }

        // Met à jour l'état => affichera les 11 symboles
        setReels(newReels);

        // Lance l'animation GSAP : fait défiler de 0px à -600px (10 * 60px)
        // Ainsi, le 11ème symbole se retrouvera en haut du «hublot».
        setTimeout(() => {
          document.querySelectorAll('.symbol-container').forEach((reelElem, index) => {
            gsap.fromTo(reelElem, 
              { y: 0 }, 
              { 
                y: -600, 
                duration: 2, 
                ease: 'power2.out', 
                onComplete: () => {
                  // Animation terminée => on autorise à relancer un spin
                  setSpinning(false);
                }
              }
            );
          });
        }, 50);
      }

      return (
        <div className="slot-machine">
          <h2>🎰 Slot Machine 🎰</h2>
          <div className="reels">
            {reels.map((col, colIndex) => (
              <div key={colIndex} className="reel">
                <div className="symbol-container">
                  {col.map((symbol, rowIndex) => (
                    <div key={rowIndex} className="symbol">
                      {symbol}
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
          <button className="spin-btn" onClick={spin} disabled={spinning}>
            {spinning ? '🎲 Spinning...' : 'Spin 🎲'}
          </button>
        </div>
      );
    }

    ReactDOM.render(<SlotMachine />, document.getElementById('root'));
  </script>
</body>
</html>